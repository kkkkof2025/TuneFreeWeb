<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TuneFree éŸ³ä¹æœç´¢ä¸‹è½½å™¨</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            padding: 24px;
            box-sizing: border-box;
        }

        /* é¡¶éƒ¨ä¿¡æ¯ */
        .header-info {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        h1 {
            color: var(--primary-color);
            margin: 0 0 10px 0;
            font-size: 1.8rem;
        }

        .credits {
            font-size: 0.85rem;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }

        .api-intro {
            font-size: 0.85rem;
            color: #666;
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: left;
            line-height: 1.6;
            border: 1px solid #eee;
        }

        /* æœç´¢åŒºåŸŸ */
        .search-box {
            display: flex;
            gap: 12px;
            margin-bottom: 10px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            outline: none;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            border-color: var(--primary-color);
        }

        button.search-btn {
            padding: 0 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: background 0.3s;
        }

        button.search-btn:hover {
            background-color: #357abd;
        }

        /* åˆ—è¡¨åŒºåŸŸ */
        .result-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }

        .result-item:hover {
            background-color: #f0f7ff;
        }

        .item-info {
            flex: 1;
            padding-right: 16px;
            min-width: 0; /* é˜²æ­¢æ–‡æœ¬æº¢å‡º */
        }

        .item-title {
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
            font-size: 1.05rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-artist {
            font-size: 0.9rem;
            color: #888;
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .platform-tag {
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
            color: white;
            vertical-align: middle;
            font-weight: normal;
        }

        .tag-netease { background-color: #c20c0c; }
        .tag-qq { background-color: #2da772; }
        .tag-kuwo { background-color: #ffcd2d; color: #333; }
        .tag-migu { background-color: #e91e63; }
        
        /* æŒ‰é’®ç»„ */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
            display: inline-block;
            border: 1px solid transparent;
        }

        .btn-download {
            background-color: #e3f2fd;
            color: #1565c0;
            border-color: #bbdefb;
        }
        .btn-download:hover { background-color: #bbdefb; }

        .btn-copy {
            background-color: #f5f5f5;
            color: #616161;
            border-color: #e0e0e0;
        }
        .btn-copy:hover { background-color: #eeeeee; }

        .loading {
            text-align: center;
            padding: 20px;
            color: #888;
            display: none;
        }

        .tip-text {
            font-size: 0.8rem;
            color: #999;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-info">
        <h1>ğŸµ TuneFree éŸ³ä¹æœç´¢ä¸‹è½½å™¨</h1>
        <div class="credits">
            Code created by k via Gemini
        </div>
        <div class="api-intro">
            <strong>â„¹ï¸ å…³äº API ä½œè€…ï¼š</strong><br>
            æœ¬å·¥å…·åŸºäºå¼€æºçš„ <strong>TuneFree API</strong> æ„å»ºã€‚è¯¥ API è‡´åŠ›äºæ‰“ç ´éŸ³ä¹å¹³å°å£å’ï¼Œèšåˆäº†ç½‘æ˜“äº‘ã€QQéŸ³ä¹ç­‰ä¸»æµå¹³å°çš„èµ„æºï¼Œä¸ºå¼€å‘è€…æä¾›ä¾¿æ·çš„éŸ³ä¹æ£€ç´¢ä¸è§£ææœåŠ¡ã€‚<br>
            <span style="font-size:0.8em; color:#aaa; margin-top:5px; display:block;">(æ³¨ï¼šæœ¬å·¥å…·ä¸ºæœ¬åœ° HTML æ¼”ç¤ºï¼Œä¸æ¶‰åŠä»»ä½•åç«¯æœåŠ¡)</span>
        </div>
    </div>

    <!-- æœç´¢åŒºåŸŸ -->
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="è¾“å…¥æ­Œæ›²åæˆ–æ­Œæ‰‹..." onkeypress="if(event.key === 'Enter') doSearch()">
        <button class="search-btn" onclick="doSearch()">æœç´¢</button>
    </div>
    <div class="tip-text">ç‚¹å‡»â€œæ‰“å¼€/ä¸‹è½½â€å°†è·³è½¬åˆ°æ–°é¡µé¢ï¼Œé€šå¸¸å¯ç›´æ¥æ’­æ”¾æˆ–ä¸‹è½½</div>

    <!-- ç»“æœåˆ—è¡¨ -->
    <div class="loading" id="loading">æ­£åœ¨æœç´¢ä¸­...</div>
    <ul class="result-list" id="resultList">
        <!-- æœç´¢ç»“æœå°†æ’å…¥è¿™é‡Œ -->
    </ul>
</div>

<script>
    // ä½¿ç”¨ç¨³å®šæ€§è¾ƒé«˜çš„é•œåƒ API åœ°å€
    const API_BASE = 'https://music-dl.sayqz.com/api'; 

    async function doSearch() {
        const keyword = document.getElementById('searchInput').value.trim();
        if (!keyword) {
            alert('è¯·è¾“å…¥å…³é”®è¯');
            return;
        }

        const loading = document.getElementById('loading');
        const list = document.getElementById('resultList');
        
        list.innerHTML = '';
        loading.style.display = 'block';

        try {
            const response = await fetch(`${API_BASE}/?type=aggregateSearch&keyword=${encodeURIComponent(keyword)}`);
            const data = await response.json();

            loading.style.display = 'none';

            if (data.code === 200 && data.data) {
                const results = Array.isArray(data.data) ? data.data : (data.data.results || []);
                renderList(results);
            } else {
                list.innerHTML = '<li style="text-align:center;padding:20px;color:#666;">æœªæ‰¾åˆ°ç›¸å…³æ­Œæ›²</li>';
            }
        } catch (error) {
            console.error("Search Error:", error);
            loading.style.display = 'none';
            list.innerHTML = '<li style="text-align:center;padding:20px;color:red;">æœç´¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</li>';
        }
    }

    function renderList(results) {
        const list = document.getElementById('resultList');
        const validResults = results.filter(item => item.id);

        if(validResults.length === 0) {
            list.innerHTML = '<li style="text-align:center;padding:20px;">æœªæ‰¾åˆ°ç»“æœ</li>';
            return;
        }

        validResults.forEach(song => {
            const li = document.createElement('li');
            li.className = 'result-item';
            
            let platformClass = 'tag-' + song.platform;
            
            // æ„å»ºä¸‹è½½é“¾æ¥
            // ä½¿ç”¨ br=320k è¯·æ±‚é«˜éŸ³è´¨
            const downloadUrl = `${API_BASE}/?source=${song.platform}&id=${song.id}&type=url&br=320k`;

            li.innerHTML = `
                <div class="item-info">
                    <span class="item-title">
                        ${escapeHtml(song.name)} 
                        <span class="platform-tag ${platformClass}">${song.platform}</span>
                    </span>
                    <span class="item-artist">${escapeHtml(song.artist)}</span>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-copy" onclick="copyToClipboard('${downloadUrl}')">å¤åˆ¶é“¾æ¥</button>
                    <a href="${downloadUrl}" target="_blank" rel="noreferrer" class="btn btn-download">æ‰“å¼€/ä¸‹è½½</a>
                </div>
            `;
            list.appendChild(li);
        });
    }

    function escapeHtml(text) {
        if (!text) return '';
        return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;");
    }

    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert('ä¸‹è½½é“¾æ¥å·²å¤åˆ¶ï¼æ‚¨å¯ä»¥å°†å…¶ç²˜è´´åˆ°æµè§ˆå™¨åœ°å€æ æˆ– IDM ä¸­ä¸‹è½½ã€‚');
        }).catch(err => {
            console.error('å¤åˆ¶å¤±è´¥', err);
            // é™çº§å¤„ç†ï¼šå¼¹çª—æ˜¾ç¤ºé“¾æ¥
            prompt("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥ï¼š", text);
        });
    }
</script>

</body>
</html>
